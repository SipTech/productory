services:
  productory-db:
    image: postgres:16-alpine
    container_name: productory-db
    restart: unless-stopped
    environment:
      POSTGRES_DB: ${POSTGRES_DB:-productory}
      POSTGRES_USER: ${POSTGRES_USER:-productory}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-productory}
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    volumes:
      - ${POSTGRES_DATA_PATH:-./.data/postgres}:/var/lib/postgresql/data

  productory-demo:
    build: .
    container_name: productory-demo
    restart: unless-stopped
    depends_on:
      - productory-db
    environment:
      DEMO_DB_ENGINE: ${DEMO_DB_ENGINE:-django.db.backends.postgresql}
      DEMO_DB_NAME: ${DEMO_DB_NAME:-productory}
      DEMO_DB_USER: ${DEMO_DB_USER:-productory}
      DEMO_DB_PASSWORD: ${DEMO_DB_PASSWORD:-productory}
      DEMO_DB_HOST: ${DEMO_DB_HOST:-productory-db}
      DEMO_DB_PORT: ${DEMO_DB_PORT:-5432}
      DEMO_ALLOWED_HOSTS: ${DEMO_ALLOWED_HOSTS:-*}
      DEMO_ENABLE_JWT: ${DEMO_ENABLE_JWT:-false}
      DEMO_SECRET_KEY: ${DEMO_SECRET_KEY:-productory-oss-demo-key}
      DEMO_DEBUG: ${DEMO_DEBUG:-true}
    ports:
      - "${DEMO_PORT:-8000}:8000"
    volumes:
      - .:/app
